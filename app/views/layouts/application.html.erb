<!DOCTYPE html>
<html>
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-W82L7HHRQH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-W82L7HHRQH');
    </script>

    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '770139866671906');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=770139866671906&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->

    <title><%= meta_title %></title>
    <meta name="description" content="<%= meta_description %>">
    <meta name="keywords" content="<%= meta_keywords %>">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="canonical" href="<%= canonical_url %>">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Open Graph -->
    <meta property="og:title" content="<%= meta_title %>">
    <meta property="og:description" content="<%= meta_description %>">
    <meta property="og:type" content="website">
    <meta property="og:url" content="<%= canonical_url %>">
    <meta property="og:image" content="<%= meta_image %>">
    <meta property="og:site_name" content="OCNJ Weekly Rentals">
    <meta property="og:locale" content="en_US">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= meta_title %>">
    <meta name="twitter:description" content="<%= meta_description %>">
    <meta name="twitter:image" content="<%= meta_image %>">

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <!-- reCAPTCHA v3 -->
    <% if ENV["RECAPTCHA_SITE_KEY"].present? %>
      <script src="https://www.google.com/recaptcha/api.js?render=<%= ENV['RECAPTCHA_SITE_KEY'] %>"></script>
      <script>
        function executeRecaptcha(form, action) {
          grecaptcha.ready(function() {
            grecaptcha.execute('<%= ENV["RECAPTCHA_SITE_KEY"] %>', {action: action}).then(function(token) {
              var input = form.querySelector('input[name="recaptcha_token"]');
              if (!input) {
                input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'recaptcha_token';
                form.appendChild(input);
              }
              input.value = token;
              form.submit();
            });
          });
        }
      </script>
    <% else %>
      <script>
        // Fallback when reCAPTCHA is not configured (dev/test)
        function executeRecaptcha(form, action) {
          form.submit();
        }
      </script>
    <% end %>

    <style>
      /* Mobile overflow fixes */
      html, body {
        overflow-x: hidden;
        max-width: 100vw;
      }
      * {
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      .prose p, .prose li {
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
    </style>

    <!-- Schema.org Organization & WebSite -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "Organization",
          "@id": "https://ocnjweeklyrentals.com/#organization",
          "name": "OCNJ Weekly Rentals",
          "description": "Find your dream vacation rental - by Idell Real Estate Team",
          "url": "https://ocnjweeklyrentals.com",
          "logo": "https://ocnjweeklyrentals.com/icon.png",
          "areaServed": {
            "@type": "City",
            "name": "Ocean City",
            "addressRegion": "NJ",
            "addressCountry": "US"
          },
          "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "customer service",
            "email": "info@bobidell.com"
          }
        },
        {
          "@type": "WebSite",
          "@id": "https://ocnjweeklyrentals.com/#website",
          "name": "OCNJ Weekly Rentals",
          "description": "Find your dream vacation rental in Ocean City, NJ",
          "url": "https://ocnjweeklyrentals.com",
          "publisher": { "@id": "https://ocnjweeklyrentals.com/#organization" },
          "potentialAction": {
            "@type": "SearchAction",
            "target": "https://ocnjweeklyrentals.com/properties?q={search_term_string}",
            "query-input": "required name=search_term_string"
          }
        }
      ]
    }
    </script>

    <%= content_for?(:schema) ? yield(:schema) : '' %>
  </head>

  <body class="bg-gray-50 min-h-screen flex flex-col">
    <%= render "shared/header" %>

    <main class="flex-1">
      <% if notice %>
        <div class="bg-green-50 border-l-4 border-green-400 p-4">
          <div class="container mx-auto">
            <p class="text-green-700"><%= notice %></p>
          </div>
        </div>
      <% end %>

      <% if alert %>
        <div class="bg-red-50 border-l-4 border-red-400 p-4">
          <div class="container mx-auto">
            <p class="text-red-700"><%= alert %></p>
          </div>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <%= render "shared/footer" %>
  </body>
</html>
