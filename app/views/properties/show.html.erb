<% content_for :title, "#{@property.full_address} | OCNJ Weekly Rentals" %>
<% content_for :meta_description, @property.meta_description %>
<% content_for :canonical_url, property_url(@property) %>
<% content_for :meta_image, @property.primary_photo_url if @property.has_photos? %>

<% content_for :schema do %>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "RealEstateListing",
  "name": "<%= j @property.address %>",
  "description": "Vacation rental property at <%= j @property.full_address %>. Contact OCNJ Weekly Rentals for availability and pricing.",
  "url": "<%= property_url(@property) %>",
  "datePosted": "<%= @property.created_at.iso8601 %>",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "<%= j @property.address %>",
    "addressLocality": "<%= j @property.city %>",
    "addressRegion": "<%= j @property.state %>",
    "postalCode": "<%= j @property.zip %>",
    "addressCountry": "US"
  },
  <% if @property.latitude.present? && @property.longitude.present? %>
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "<%= @property.latitude %>",
    "longitude": "<%= @property.longitude %>"
  },
  <% end %>
  "broker": {
    "@type": "RealEstateAgent",
    "name": "OCNJ Weekly Rentals",
    "description": "Find your dream vacation rental - by Idell Real Estate Team",
    "url": "https://ocnjweeklyrentals.com"
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://ocnjweeklyrentals.com" },
      { "@type": "ListItem", "position": 2, "name": "Properties", "item": "https://ocnjweeklyrentals.com/properties" },
      { "@type": "ListItem", "position": 3, "name": "<%= j @property.address %>" }
    ]
  }
}
</script>
<% end %>

<!-- Back Navigation -->
<div class="bg-white border-b border-gray-200">
  <div class="px-2 sm:px-4 py-2 sm:py-3">
    <%= link_to properties_path, class: "inline-flex items-center text-blue-600 hover:text-blue-700 font-semibold text-sm" do %>
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      Back
    <% end %>
  </div>
</div>

<!-- Mobile Sticky Contact Button -->
<div class="lg:hidden fixed bottom-0 left-0 right-0 z-40 bg-white border-t border-gray-200 p-2 sm:p-3 shadow-lg">
  <a href="#contact-form" class="block w-full py-2.5 sm:py-3 bg-blue-600 text-white font-bold rounded-lg text-center text-base shadow-md">
    Request Information
  </a>
</div>

<div class="bg-gray-50 min-h-screen py-3 sm:py-4 md:py-6 pb-20 lg:pb-6 overflow-x-hidden">
  <div class="mx-auto px-2 sm:px-4 max-w-7xl overflow-hidden">
    <div class="w-full">

      <div class="grid lg:grid-cols-3 gap-8">

        <!-- Main Content Column -->
        <div class="lg:col-span-2 space-y-6">

          <!-- Property Photos -->
          <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <% if @property.has_photos? %>
              <!-- Photo Gallery -->
              <div class="relative">
                <!-- Main Photo -->
                <div class="h-48 sm:h-64 md:h-80 lg:h-96 relative cursor-pointer" id="main-photo-container" onclick="openLightbox(0)">
                  <img src="<%= @property.primary_photo_url %>"
                       alt="<%= @property.address %>"
                       class="w-full h-full object-cover"
                       id="main-photo"
                       loading="eager">

                  <% if @property.photo_count > 1 %>
                    <div class="absolute bottom-4 right-4 bg-black/70 text-white px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-2">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                      <%= @property.photo_count %> Photos
                    </div>
                  <% end %>

                  <!-- View Photos Overlay -->
                  <div class="absolute inset-0 bg-black/0 hover:bg-black/20 transition-all flex items-center justify-center opacity-0 hover:opacity-100">
                    <span class="bg-white/90 text-gray-900 px-4 py-2 rounded-lg font-semibold shadow-lg">
                      Click to view photos
                    </span>
                  </div>

                  <% if @property.is_verified %>
                    <div class="absolute top-6 right-6 bg-green-500 text-white px-4 py-2 rounded-full text-sm font-bold shadow-xl flex items-center gap-2">
                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                      </svg>
                      Verified Property
                    </div>
                  <% end %>
                </div>

                <!-- Thumbnail Strip -->
                <% if @property.photo_count > 1 %>
                  <div class="flex gap-2 p-3 overflow-x-auto bg-gray-100 -webkit-overflow-scrolling-touch">
                    <% @property.photo_urls.first(20).each_with_index do |url, index| %>
                      <button onclick="openLightbox(<%= index %>)"
                              class="flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden border-2 border-transparent hover:border-blue-500 focus:border-blue-500 transition-all active:scale-95">
                        <img src="<%= url %>" alt="Photo <%= index + 1 %>" class="w-full h-full object-cover" loading="lazy">
                      </button>
                    <% end %>
                    <% if @property.photo_count > 20 %>
                      <button onclick="openLightbox(20)" class="flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-lg bg-gray-200 flex items-center justify-center text-gray-600 font-semibold text-sm">
                        +<%= @property.photo_count - 20 %>
                      </button>
                    <% end %>
                  </div>
                <% end %>
              </div>

              <!-- Lightbox Modal -->
              <div id="lightbox" class="fixed inset-0 z-50 hidden bg-black/95" onclick="closeLightbox(event)">
                <!-- Close Button -->
                <button onclick="closeLightbox()" class="absolute top-4 right-4 z-10 text-white hover:text-gray-300 transition-colors">
                  <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>

                <!-- Photo Counter -->
                <div class="absolute top-4 left-4 text-white text-lg font-semibold">
                  <span id="lightbox-counter">1</span> / <%= @property.photo_count %>
                </div>

                <!-- Previous Button -->
                <button onclick="prevPhoto(event)" class="absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors p-3 sm:p-2 bg-black/30 sm:bg-transparent rounded-full active:bg-black/50">
                  <svg class="w-8 h-8 sm:w-12 sm:h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                  </svg>
                </button>

                <!-- Next Button -->
                <button onclick="nextPhoto(event)" class="absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors p-3 sm:p-2 bg-black/30 sm:bg-transparent rounded-full active:bg-black/50">
                  <svg class="w-8 h-8 sm:w-12 sm:h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </button>

                <!-- Main Image -->
                <div class="flex items-center justify-center h-full p-4 sm:p-8 md:p-16 pt-16 pb-24">
                  <img id="lightbox-image" src="" alt="Property photo" class="max-h-full max-w-full object-contain">
                </div>

                <!-- Thumbnail Strip -->
                <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 max-w-[90vw] overflow-x-auto p-2 bg-black/50 rounded-lg">
                  <% @property.photo_urls.each_with_index do |url, index| %>
                    <button onclick="goToPhoto(<%= index %>, event)"
                            class="flex-shrink-0 w-16 h-16 rounded overflow-hidden border-2 transition-all lightbox-thumb"
                            data-index="<%= index %>">
                      <img src="<%= url %>" alt="Photo <%= index + 1 %>" class="w-full h-full object-cover">
                    </button>
                  <% end %>
                </div>
              </div>

              <script>
                const photoUrls = <%= raw @property.photo_urls.to_json %>;
                let currentPhotoIndex = 0;

                function openLightbox(index) {
                  currentPhotoIndex = index;
                  updateLightboxImage();
                  document.getElementById('lightbox').classList.remove('hidden');
                  document.body.style.overflow = 'hidden';
                }

                function closeLightbox(event) {
                  if (event && event.target !== event.currentTarget) return;
                  document.getElementById('lightbox').classList.add('hidden');
                  document.body.style.overflow = '';
                }

                function prevPhoto(event) {
                  event.stopPropagation();
                  currentPhotoIndex = (currentPhotoIndex - 1 + photoUrls.length) % photoUrls.length;
                  updateLightboxImage();
                }

                function nextPhoto(event) {
                  event.stopPropagation();
                  currentPhotoIndex = (currentPhotoIndex + 1) % photoUrls.length;
                  updateLightboxImage();
                }

                function goToPhoto(index, event) {
                  event.stopPropagation();
                  currentPhotoIndex = index;
                  updateLightboxImage();
                }

                function updateLightboxImage() {
                  document.getElementById('lightbox-image').src = photoUrls[currentPhotoIndex];
                  document.getElementById('lightbox-counter').textContent = currentPhotoIndex + 1;
                  document.getElementById('main-photo').src = photoUrls[currentPhotoIndex];

                  // Update thumbnail borders
                  document.querySelectorAll('.lightbox-thumb').forEach((thumb, i) => {
                    if (i === currentPhotoIndex) {
                      thumb.classList.add('border-white');
                      thumb.classList.remove('border-transparent');
                    } else {
                      thumb.classList.remove('border-white');
                      thumb.classList.add('border-transparent');
                    }
                  });
                }

                // Keyboard navigation
                document.addEventListener('keydown', function(e) {
                  const lightbox = document.getElementById('lightbox');
                  if (lightbox.classList.contains('hidden')) return;

                  if (e.key === 'Escape') closeLightbox();
                  if (e.key === 'ArrowLeft') { e.preventDefault(); prevPhoto(e); }
                  if (e.key === 'ArrowRight') { e.preventDefault(); nextPhoto(e); }
                });
              </script>
            <% else %>
              <!-- Placeholder when no photos -->
              <div class="h-96 bg-gradient-to-br from-blue-400 via-cyan-400 to-blue-500 flex items-center justify-center relative">
                <div class="absolute inset-0 opacity-10" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>

                <div class="relative z-10 text-center">
                  <svg class="w-32 h-32 text-white mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                  </svg>
                  <p class="text-white text-lg font-semibold">Property Photos Coming Soon</p>
                </div>

                <% if @property.is_verified %>
                  <div class="absolute top-6 right-6 bg-green-500 text-white px-4 py-2 rounded-full text-sm font-bold shadow-xl flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    Verified Property
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>

          <!-- Property Details Card -->
          <div class="bg-white rounded-xl shadow-lg p-3 sm:p-4 md:p-6 lg:p-8 overflow-hidden">
            <div class="mb-3 sm:mb-4">
              <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
                <div>
                  <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-900 mb-1 sm:mb-2 break-words">
                    <%= @property.address %>
                  </h1>
                  <p class="text-base sm:text-lg md:text-xl text-gray-600 break-words">
                    <%= @property.city %>, <%= @property.state %> <%= @property.zip %>
                  </p>
                </div>
                <% unless @property.has_approved_owner? %>
                  <%= link_to new_owner_claim_path(property_id: @property.id),
                    class: "inline-flex items-center gap-2 px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 text-sm font-semibold rounded-lg transition-colors whitespace-nowrap" do %>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                    Is this your property?
                  <% end %>
                <% end %>
              </div>
            </div>

            <!-- Property Features Grid -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 py-4 sm:py-6 border-t border-b border-gray-200">
              <div class="text-center p-2 bg-gray-50 rounded-lg">
                <p class="text-xs text-gray-500">Type</p>
                <p class="font-bold text-gray-900 text-sm truncate">
                  <%= @property.property_type || '-' %>
                </p>
              </div>

              <div class="text-center p-2 bg-gray-50 rounded-lg">
                <p class="text-xs text-gray-500">Beds</p>
                <p class="font-bold text-gray-900 text-sm">
                  <%= @property.bedrooms.present? && @property.bedrooms > 0 ? @property.bedrooms : '-' %>
                </p>
              </div>

              <div class="text-center p-2 bg-gray-50 rounded-lg">
                <p class="text-xs text-gray-500">Baths</p>
                <p class="font-bold text-gray-900 text-sm">
                  <%= @property.bathrooms.present? && @property.bathrooms > 0 ? @property.bathrooms : '-' %>
                </p>
              </div>

              <div class="text-center p-2 bg-gray-50 rounded-lg">
                <p class="text-xs text-gray-500">Sleeps</p>
                <p class="font-bold text-gray-900 text-sm">
                  <%= @property.total_sleeps.present? && @property.total_sleeps > 0 ? @property.total_sleeps : '-' %>
                </p>
              </div>
            </div>

            <!-- About Section -->
            <div class="mt-4 sm:mt-6 overflow-hidden">
              <h2 class="text-lg sm:text-xl font-bold text-gray-900 mb-2 sm:mb-3">
                About This Property
              </h2>
              <div class="text-gray-600 text-sm leading-relaxed break-words">
                <% if @property.description.present? %>
                  <p class="mb-4 whitespace-pre-line break-words"><%= @property.description %></p>
                <% else %>
                  <p class="mb-4 break-words">
                    This Ocean City property is available for vacation rental. Located at
                    <%= @property.address %> in <%= @property.city %>, this property offers
                    convenient access to Ocean City's beautiful beaches, boardwalk attractions,
                    restaurants, and entertainment.
                  </p>
                <% end %>
                <p class="break-words">
                  Contact Bob Idell Real Estate for complete property details, availability,
                  pricing, and booking information. We'll help you secure the perfect Ocean City
                  rental for your next beach vacation.
                </p>
              </div>
            </div>

            <% if @property.has_amenities? %>
              <!-- Amenities Section -->
              <div class="mt-6 sm:mt-8 pt-6 sm:pt-8 border-t border-gray-200">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-3 sm:mb-4">
                  Amenities
                </h2>
                <div class="grid grid-cols-2 gap-2 sm:gap-3">
                  <% @property.amenity_list.first(18).each do |amenity| %>
                    <div class="flex items-center gap-2 text-gray-600">
                      <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                      </svg>
                      <span class="text-sm"><%= amenity %></span>
                    </div>
                  <% end %>
                </div>
                <% if @property.amenity_list.count > 18 %>
                  <p class="mt-4 text-sm text-gray-500">+ <%= @property.amenity_list.count - 18 %> more amenities</p>
                <% end %>
              </div>
            <% end %>

            <% if @property.rate_description.present? || @property.fee_descriptions.present? %>
              <!-- Rates & Fees Section -->
              <div class="mt-8 pt-8 border-t border-gray-200">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">
                  Rates & Fees
                </h2>
                <div class="prose prose-lg max-w-none text-gray-600">
                  <% if @property.rate_description.present? %>
                    <p class="whitespace-pre-line"><%= @property.rate_description %></p>
                  <% end %>
                  <% if @property.fee_descriptions.present? %>
                    <p class="mt-4 whitespace-pre-line text-sm text-gray-500"><%= @property.fee_descriptions %></p>
                  <% end %>
                </div>
              </div>
            <% end %>

            <% if @property.virtual_tour_url.present? %>
              <!-- Virtual Tour -->
              <div class="mt-8 pt-8 border-t border-gray-200">
                <a href="<%= @property.virtual_tour_url %>"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="inline-flex items-center gap-2 px-6 py-3 bg-blue-100 text-blue-700 font-semibold rounded-lg hover:bg-blue-200 transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                  </svg>
                  Take a Virtual Tour
                </a>
              </div>
            <% end %>
          </div>

          <% if @property.has_rates? || @property.has_availability? %>
          <!-- Weekly Rentals - Compact View -->
          <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
            <h2 class="text-lg sm:text-2xl font-bold text-gray-900 mb-3 sm:mb-4">
              <svg class="w-5 h-5 sm:w-6 sm:h-6 inline-block mr-1 sm:mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              Weekly Availability & Rates
            </h2>

            <% if @property.has_rates? %>
            <!-- Compact Rate Table -->
            <div class="mb-6 overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-gray-200">
                    <th class="text-left py-2 text-gray-600 font-medium">Week</th>
                    <th class="text-right py-2 text-gray-600 font-medium">Rate</th>
                  </tr>
                </thead>
                <tbody>
                  <% @property.weekly_rates.first(12).each do |rate| %>
                    <%
                      check_in = Date.parse(rate[:check_in_date]) rescue nil
                      check_out = Date.parse(rate[:check_out_date]) rescue nil
                      is_past = check_in && check_in < Date.today
                    %>
                    <% unless is_past %>
                    <tr class="border-b border-gray-100 hover:bg-green-50">
                      <td class="py-2">
                        <span class="inline-flex items-center gap-2">
                          <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                          <% if check_in && check_out %>
                            <%= check_in.strftime("%b %d") %> - <%= check_out.strftime("%b %d") %>
                          <% else %>
                            <%= rate[:description] %>
                          <% end %>
                        </span>
                      </td>
                      <td class="py-2 text-right">
                        <% if rate[:rate].present? && rate[:rate] > 0 %>
                          <span class="font-bold text-green-600">$<%= number_with_delimiter(rate[:rate].to_i) %></span>
                        <% end %>
                      </td>
                    </tr>
                    <% end %>
                  <% end %>
                </tbody>
              </table>
            </div>
            <% end %>

            <!-- 12-Month Rolling Calendar -->
            <div class="border-t border-gray-200 pt-4">
              <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-medium text-gray-700">12-Month Calendar</span>
                <div class="flex items-center gap-4 text-xs">
                  <span class="flex items-center gap-1"><span class="w-3 h-3 bg-green-500 rounded"></span> Available</span>
                  <span class="flex items-center gap-1"><span class="w-3 h-3 bg-gray-200 rounded"></span> Booked</span>
                </div>
              </div>

              <% available = @property.available_dates %>
              <% current_month = Date.today.beginning_of_month %>

              <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                <% 12.times do |month_offset| %>
                  <% month = current_month + month_offset.months %>
                  <div class="border border-gray-100 rounded p-1.5">
                    <p class="text-xs font-semibold text-gray-700 mb-1 text-center"><%= month.strftime("%b %Y") %></p>
                    <div class="grid grid-cols-7 gap-px text-center" style="font-size: 8px;">
                      <% (month.beginning_of_month.wday).times do %><div></div><% end %>
                      <% (month.beginning_of_month..month.end_of_month).each do |date| %>
                        <% is_available = available.include?(date.to_s) %>
                        <% is_past = date < Date.today %>
                        <div class="py-0.5 rounded <%= is_past ? 'text-gray-300' : is_available ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-400' %>">
                          <%= date.day %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              </div>
              <p class="text-xs text-gray-400 text-center mt-3">Contact us for the most current availability</p>
            </div>
          </div>
          <% end %>

          <!-- Location Section -->
          <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 md:p-8">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-3 sm:mb-4">
              <svg class="w-5 h-5 sm:w-6 sm:h-6 inline-block mr-1 sm:mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              Location
            </h2>
            <p class="text-gray-600 mb-3 sm:mb-4 text-sm sm:text-base">
              <%= @property.full_address %>
            </p>
            <div class="h-56 sm:h-64 md:h-80 rounded-lg overflow-hidden">
              <iframe
                width="100%"
                height="100%"
                style="border:0"
                loading="lazy"
                allowfullscreen
                referrerpolicy="no-referrer-when-downgrade"
                src="https://www.google.com/maps?q=<%= ERB::Util.url_encode(@property.full_address) %>&output=embed">
              </iframe>
            </div>
            <div class="mt-3 text-right">
              <a href="https://www.google.com/maps/search/?api=1&query=<%= ERB::Util.url_encode(@property.full_address) %>"
                 target="_blank"
                 rel="noopener noreferrer"
                 class="inline-flex items-center text-blue-600 hover:text-blue-700 font-semibold text-sm">
                <span>Open in Google Maps</span>
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                </svg>
              </a>
            </div>
          </div>

        </div>

        <!-- Sidebar - Contact Form -->
        <div class="lg:col-span-1 overflow-hidden" id="contact-form">
          <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 md:p-8 lg:sticky lg:top-8 overflow-hidden">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-2">
              Request Information
            </h2>
            <p class="text-gray-600 mb-6">
              Bob Idell will get back to you within 24 hours with availability and pricing details.
            </p>

            <div id="lead-form">
              <%= form_with model: [@property, @lead],
                            data: { turbo_frame: "lead-form" },
                            class: "space-y-5" do |f| %>

                <% if @lead.errors.any? %>
                  <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                    <div class="flex">
                      <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                        </svg>
                      </div>
                      <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800">
                          Please correct the following:
                        </h3>
                        <div class="mt-2 text-sm text-red-700">
                          <ul class="list-disc list-inside space-y-1">
                            <% @lead.errors.full_messages.each do |message| %>
                              <li><%= message %></li>
                            <% end %>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>

                <div>
                  <%= f.label :name, "Your Name", class: "block text-sm font-semibold text-gray-700 mb-2" %>
                  <%= f.text_field :name,
                    required: true,
                    placeholder: "John Smith",
                    class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                  %>
                </div>

                <div>
                  <%= f.label :email, "Email Address", class: "block text-sm font-semibold text-gray-700 mb-2" %>
                  <%= f.email_field :email,
                    required: true,
                    placeholder: "john@example.com",
                    class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                  %>
                </div>

                <div>
                  <%= f.label :phone, "Phone Number", class: "block text-sm font-semibold text-gray-700 mb-2" %>
                  <div class="text-xs text-gray-500 mb-2">Optional</div>
                  <%= f.telephone_field :phone,
                    placeholder: "(609) 555-0123",
                    class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                  %>
                </div>

                <div>
                  <%= f.label :message, "Tell Us About Your Rental Needs", class: "block text-sm font-semibold text-gray-700 mb-2" %>
                  <%= f.text_area :message,
                    rows: 5,
                    placeholder: "When are you looking to visit? How many guests? Any specific requirements?",
                    class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none"
                  %>
                </div>

                <%= f.hidden_field :lead_type, value: 'rental_inquiry' %>

                <%= f.submit "Request Information",
                  class: "w-full px-6 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all cursor-pointer"
                %>

                <p class="text-xs text-gray-500 text-center leading-relaxed">
                  By submitting this form, you agree to be contacted by Bob Idell Real Estate
                  regarding this property and your rental needs.
                </p>
              <% end %>
            </div>

            <!-- Contact Info -->
            <div class="mt-8 pt-8 border-t border-gray-200">
              <h3 class="font-bold text-gray-900 mb-4">Contact Bob Idell Real Estate</h3>
              <div class="space-y-3 text-sm text-gray-600">
                <div class="flex items-center gap-3">
                  <svg class="w-5 h-5 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                  </svg>
                  <a href="mailto:info@bobidell.com" class="hover:text-blue-600">info@bobidell.com</a>
                </div>
                <div class="flex items-center gap-3">
                  <svg class="w-5 h-5 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <span>Ocean City, NJ</span>
                </div>
              </div>
            </div>

            <!-- Owner CTA -->
            <% unless @property.has_approved_owner? %>
            <div class="mt-6 pt-6 border-t border-gray-200">
              <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg p-4 text-center">
                <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                  <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                  </svg>
                </div>
                <p class="font-semibold text-gray-900 mb-1">Is this your property?</p>
                <p class="text-xs text-gray-600 mb-3">Claim it to manage your listing, view analytics, and upload photos.</p>
                <%= link_to "Claim This Property", new_owner_claim_path(property_id: @property.id),
                  class: "inline-block px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold rounded-lg transition-colors" %>
              </div>
            </div>
            <% end %>
          </div>
        </div>

      </div>

      <!-- About Ocean City Section -->
      <div class="mt-6 sm:mt-8 md:mt-12 bg-white rounded-xl shadow-lg p-4 sm:p-6 md:p-8 overflow-hidden">
        <h2 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-900 mb-4 sm:mb-6">
          About Ocean City, NJ Vacation Rentals
        </h2>
        <div class="text-gray-600 text-sm sm:text-base leading-relaxed break-words">
          <p class="mb-4 break-words">
            Ocean City, New Jersey is a premier family-friendly vacation destination on the Jersey Shore.
            Known for its pristine beaches, famous boardwalk, and welcoming atmosphere, Ocean City offers
            the perfect setting for your summer getaway or extended beach vacation.
          </p>
          <p class="mb-4 break-words">
            <%= @property.address %> is ideally located in Ocean City, providing convenient access to
            the beach, boardwalk attractions, shopping, dining, and entertainment. Whether you're planning
            a week-long summer vacation, a long weekend getaway, or an extended seasonal rental, this
            property puts you in the heart of everything Ocean City has to offer.
          </p>
          <p class="break-words">
            Bob Idell Real Estate has been helping families find their perfect Ocean City vacation rental
            since 2016. With extensive local knowledge and a commitment to personalized service, we'll help
            you navigate the rental process and secure the ideal property for your needs. Contact us today
            to learn more about <%= @property.address %> and start planning your Ocean City vacation.
          </p>
        </div>
      </div>

    </div>
  </div>
</div>
